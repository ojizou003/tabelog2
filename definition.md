# 食べログ営業リスト作成ツール要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
食べログ営業リスト作成ツール

### 1.2 目的
食べログ（https://tabelog.com/）から店舗情報を収集し、営業活動に活用するための店舗リストを効率的に作成する。

### 1.3 システム概要
StreamlitベースのWebアプリケーションで、指定した都道府県とキーワードに基づいて食べログから店舗情報をスクレイピングし、構造化されたデータとして出力する。

## 2. 機能要件

### 2.1 検索機能
- **検索条件設定**
  - 都道府県：セレクトボックスによる選択（47都道府県）
  - キーワード：テキストボックスによる自由入力
  
- **検索範囲**
  - 対象URL：`https://tabelog.com/{都道府県}/rstLst/{page-num}/?sk={キーワード}`
  - ページ数：1～最大60ページ
  - 1ページあたり店舗数：20件

### 2.2 データ収集機能
- **リストページからの情報取得**
  - 店舗ページURLの抽出
  - 各ページの店舗リンク収集

- **店舗ページからの詳細情報取得**
  - 店名
  - ジャンル
  - 住所
  - 電話番号
  - 予約・お問い合わせ
  - ホームページ
  - 席数

### 2.3 データ表示機能
- **GUI表示**
  - Streamlitによるユーザーインターフェース
  - Pandasデータフレームによるテーブル表示
  - 検索結果の一覧表示

### 2.4 データ出力機能
- **CSVファイル出力**
  - 収集したデータをCSV形式で保存
  - ダウンロード機能の提供

## 3. 技術要件

### 3.1 開発言語・フレームワーク
- **Python**
  - Streamlit：GUI作成
  - Pandas：データ処理
  - Requests/BeautifulSoup：Webスクレイピング

### 3.2 データ処理
- **都道府県名変換**
  - 漢字表記からローマ字表記への変換機能
  - 変換テーブルの実装

### 3.3 URL構造
- **リストページURL**
  - ベースURL：`https://tabelog.com/{都道府県}/rstLst/{page-num}/?sk={キーワード}`
  - 都道府県：ローマ字表記（例：hokkaido, aomori, fukuoka）
  - ページ番号：1～60
  - キーワード：URLエンコード対応

## 4. 非機能要件

### 4.1 パフォーマンス要件
- **レスポンス時間**
  - 1ページあたりの処理時間：5秒以内
  - 全体処理時間：合理的な範囲内

### 4.2 可用性要件
- **エラーハンドリング**
  - ネットワークエラー時の適切な処理
  - ページが存在しない場合の対応
  - 取得できない項目がある場合の対応

### 4.3 セキュリティ要件
- **アクセス制御**
  - 適切なアクセス間隔の設定
  - robots.txtの遵守
  - 利用規約の遵守

## 5. ユーザーインターフェース要件

### 5.1 入力項目
- **都道府県選択**
  - UI：セレクトボックス
  - 表示：漢字表記（北海道、青森県、福岡県など）
  - 内部処理：ローマ字変換

- **キーワード入力**
  - UI：テキストボックス
  - 入力制限：特殊文字のエスケープ処理

### 5.2 出力項目
- **データ表示**
  - Pandasデータフレームによるテーブル表示
  - 検索結果件数の表示
  - 処理状況の表示

- **ダウンロード機能**
  - CSV形式でのファイル出力
  - ファイル名の自動生成

## 6. データ仕様

### 6.1 出力データ項目
| 項目名 | データ型 | 必須 | 備考 |
|--------|----------|------|------|
| 店名 | 文字列 | ◯ | |
| ジャンル | 文字列 | △ | 複数ジャンルの場合は区切り文字で連結 |
| 住所 | 文字列 | △ | |
| 電話番号 | 文字列 | △ | ハイフン区切り形式 |
| 予約・お問い合わせ | 文字列 | △ | ハイフン区切り形式 |
| ホームページ | 文字列 | △ | URL形式 |
| 席数 | 数値 | △ | 最初のpタグのテキストのみ抽出 |

### 6.2 都道府県変換テーブル
| 漢字表記 | ローマ字表記 |
|----------|-------------|
| 北海道 | hokkaido |
| 青森県 | aomori |
| 岩手県 | iwate |
| ... | ... |
| 福岡県 | fukuoka |
| ... | ... |

## 7. 制約事項

### 7.1 技術的制約
- 食べログの利用規約に準拠
- アクセス頻度の制限
- ページ構造変更への対応

### 7.2 運用制約
- 商用利用時の注意事項
- 個人情報の取り扱い
- データの更新頻度

## 8. 開発スケジュール

### 8.1 開発フェーズ
1. **設計フェーズ**（1週間）
   - 詳細設計
   - UI設計

2. **開発フェーズ**（2週間）
   - スクレイピング機能実装
   - GUI実装
   - データ処理機能実装
   - 主要ファイル (`app.py`, `utils.py`, `scraper.py`) の作成完了 (`utils.py` と `scraper.py` の連携完了)
   - スクレイピング機能実装完了

3. **テストフェーズ**（1週間）
   - 単体テスト (pytestが必要)
       - `utils.py`: 都道府県名ローマ字変換
       - `scraper.py`:
           - 検索URL構築
           - リストページからの店舗URL抽出
           - 店舗ページからの詳細情報抽出 (各種データ項目、欠落、フォーマット含む)
           - ページコンテンツ取得 (`get_page_content`)
           - スクレイピング実行 (`scrape_tabelog`)
       - `app.py`:
           - 検索実行 (`run_search`)
   - 結合テスト
   - ユーザーテスト

4. **リリースフェーズ**（0.5週間）
   - デプロイ
   - 運用開始

## 9. リスク要因

### 9.1 技術的リスク
- 食べログのページ構造変更
- アクセス制限による取得失敗
- 大量データ処理時のパフォーマンス低下

### 9.2 運用リスク
- 利用規約変更による影響
- 法的制約の変更
- サーバーダウン時の対応
