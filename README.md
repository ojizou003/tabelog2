# tabelog 営業リスト作成ツール

## 概要
`tabelog` は、食べログ（https://tabelog.com/）から店舗情報を取得し、営業活動に活用できるリスト（CSV）を作成するための Streamlit アプリです。都道府県とジャンルを指定して検索し、取得したデータを画面表示・ダウンロードできます。

## 主な機能
- 都道府県・ジャンルを指定して食べログをスクレイピング
- 取得データのテーブル表示（件数表示・進捗表示）
- CSV ダウンロード（UTF-8）
- 取得ページ数の上限指定（1〜60）

## 取得対象と範囲
- 対象 URL 例
  - `https://tabelog.com/{都道府県ローマ字}/rstLst/{ジャンルローマ字}/{page}/`
  - ジャンル未選択時は `https://tabelog.com/{都道府県ローマ字}/rstLst/{page}/`
- ページ範囲: 1〜最大 60 ページ（1ページあたり最大20件想定）

## 取得項目
- 店名
- ジャンル
- 住所（最初の改行まで）
- 電話番号
- 予約・お問い合わせ
- ホームページ
- 席数（最初の p タグのテキスト or 先頭行）

※ 食べログに情報がない項目は空欄（ハイフン）になります。

## 動作環境
- Python 3.13
- 主要ライブラリ
  - streamlit
  - requests / beautifulsoup4
  - pandas

依存関係は `pyproject.toml` に定義されています。

## セットアップ
1. 依存関係のインストール（uv を利用）
   ```bash
   uv sync
   ```
2. アプリの起動
   ```bash
   streamlit run app.py
   ```

## 使い方
1. アプリを起動後、サイドバーで以下を設定します。
   - 都道府県（必須）
   - ジャンル（任意）
   - 最大ページ数（1〜60）
2. 「検索実行」ボタンを押すとスクレイピングが開始されます。
3. 結果テーブルが表示され、CSV をダウンロードできます。

ヒント:
- 初回は「最大ページ数」を 1〜2 に設定して動作確認することを推奨します。
- 進捗バーは概算（ページ×20件想定）で表示しています。

## 出力
- CSV ファイル（UTF-8, ヘッダ付き, インデックスなし）
- ファイル名例: `tabelog_tokyo_ramen_YYYYMMDD_HHMMSS.csv`

## 注意事項・コンプライアンス
- 本プロジェクトは学習・研究目的で作成されています。
- スクレイピング対象サイトの robots.txt と利用規約を遵守してください。
- アクセス間隔を十分に取り、過剰な負荷を与えないようにしてください（現在は 1 秒/リクエスト程度の待機を実装）。
- 取得データの利用は自己責任でお願いします。

## ディレクトリ構成
```
.
├─ app.py         # Streamlit アプリ本体
├─ scraper.py     # スクレイピング処理（URL構築・ページ解析）
├─ utils.py       # 都道府県/ジャンルのローマ字変換
├─ main.py        # シンプルなエントリーポイント（任意）
├─ definition.md  # 要件定義書
├─ pyproject.toml # 依存関係定義
├─ uv.lock        # 依存のロックファイル
└─ README.md      # このファイル
```

## 開発向けメモ
- ログ出力: `logging` を利用（INFO レベル）。必要に応じてレベルやフォーマットを調整してください。
- 早期終了: リストページで店舗リンクが見つからない場合、2ページ目以降であれば最終ページ到達と判断して終了します。
- 例外処理: リクエストの HTTP エラーは握りつつエラーログを出力してスキップします。

## トラブルシューティング
- 依存エラーが出る: `uv sync` を再実行。あるいは `pip install -r requirements.txt` 相当の手動インストールを検討。
- ページが取得されない: 指定した都道府県/ジャンルのローマ字変換が正しいか `utils.py` を確認。
- 途中で停止する: ネットワーク状況やレートリミットの可能性あり。最大ページ数を下げて再試行してください。

## ライセンス
MIT License

## 更新履歴
- 2025-09: 最大取得ページ数の上限を 60 → 40 に変更（UI・内部ロジック・ドキュメントを更新）
- 2025-09: 最大取得ページ数の上限を 40 → 60 に変更（max60 ブランチ）
